<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        
        .header {
            background-color: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .header-right {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }
        
        .header h1 {
            margin: 0 0 4px 0;
            font-size: 20px;
        }
        
        .date-nav-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin: 4px 0;
        }
        
        .date-display {
            font-size: 14px;
            color: #007bff;
            margin: 0;
            min-width: 160px;
            text-align: center;
        }
        
        .date-nav-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        .date-nav-btn:hover {
            background-color: #0056b3;
        }
        
        .today-btn {
            margin-top: 5px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid;
        }
        
        .stat-item.present { border-left-color: #28a745; }
        .stat-item.absent { border-left-color: #dc3545; }
        .stat-item.late { border-left-color: #ffc107; }
        .stat-item.early { border-left-color: #17a2b8; }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 370px;
            gap: 15px;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
        }
        
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        
        .controls {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .controls h3 {
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        
        .control-button {
            padding: 8px 14px;
            margin: 3px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .export-btn { background-color: #28a745; color: white; }
        .export-btn:hover { background-color: #218838; }
        
        .history-btn { background-color: #007bff; color: white; }
        .history-btn:hover { background-color: #0056b3; }
        
        .reset-btn { background-color: #6c757d; color: white; }
        .reset-btn:hover { background-color: #5a6268; }
        
        .clear-all-btn { background-color: #dc3545; color: white; }
        .clear-all-btn:hover { background-color: #c82333; }
        
        .calendar-section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .day-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background-color: #0056b3;
        }
        
        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 3px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-day-header {
            background-color: #f8f9fa;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            color: #495057;
            border-bottom: 1px solid #dee2e6;
        }
        
        .calendar-day {
            border: 1px solid #dee2e6;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 8px 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 65px;
            font-size: 13px;
        }
        
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        
        .calendar-day.other-month {
            background-color: #f8f9fa;
            color: #6c757d;
        }
        
        .calendar-day.today {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }
        
        .calendar-day.selected {
            background-color: #007bff;
            color: white;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 4px;
            font-size: 16px;
        }
        
        .day-stats {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
            font-size: 10px;
            width: 100%;
        }
        
        .stat-badge {
            display: block;
            padding: 2px 4px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 9px;
            text-align: center;
            margin: 1px 0;
            max-width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            cursor: help;
        }
        
        .stat-badge.absent { background-color: #dc3545; }
        .stat-badge.late { background-color: #ffc107; color: #212529; }
        .stat-badge.early { background-color: #17a2b8; }
        
        .student-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
        }
        
        .student-card {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: #f8f9fa;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .student-card.absent {
            background-color: #f8d7da;
            border-color: #dc3545;
        }
        
        .student-card.late {
            background-color: #fff3cd;
            border-color: #ffc107;
        }
        
        .student-card.early-leave {
            background-color: #d1ecf1;
            border-color: #17a2b8;
        }
        
        .student-card.absent .student-number,
        .student-card.late .student-number,
        .student-card.early-leave .student-number {
            color: #333;
        }
        
        .student-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            min-height: 20px;
        }
        
        .student-number {
            font-size: 16px;
            font-weight: bold;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .student-status {
            font-size: 10px;
            color: #666;
            min-width: 30px;
            text-align: left;
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3px;
        }
        
        .status-btn {
            padding: 4px 6px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        
        .btn-absent {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-absent:hover {
            background-color: #c82333;
        }
        
        .btn-late {
            background-color: #ffc107;
            color: #212529;
        }
        
        .btn-late:hover {
            background-color: #e0a800;
        }
        
        .btn-early {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-early:hover {
            background-color: #138496;
        }
        
        .btn-clear {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #5a6268;
        }
        
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .period-modal {
            max-width: 400px;
            text-align: center;
        }
        
        .period-modal h3 {
            margin: 0 0 20px 0;
            font-size: 18px;
            color: #333;
        }
        
        .period-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .period-btn {
            padding: 15px 10px;
            border: 2px solid #007bff;
            border-radius: 8px;
            background-color: white;
            color: #007bff;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .period-btn:hover {
            background-color: #007bff;
            color: white;
        }
        
        .period-btn.cancel-btn {
            grid-column: span 4;
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        
        .period-btn.cancel-btn:hover {
            background-color: #5a6268;
            border-color: #545b62;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-header h2 {
            margin: 0;
        }
        
        /* í”„ë¦°íŠ¸ ì „ìš© ìŠ¤íƒ€ì¼ */
        @media print {
            body * {
                visibility: hidden;
            }
            
            #historyModal, #historyModal * {
                visibility: visible;
            }
            
            #historyModal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: white !important;
                margin: 0;
                padding: 20px;
                box-sizing: border-box;
            }
            
            .modal-content {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .close, .control-button {
                display: none !important;
            }
            
            .modal-header {
                border-bottom: 2px solid #333;
                padding-bottom: 10px;
                margin-bottom: 20px;
            }
            
            .modal-header h2 {
                color: #333 !important;
                font-size: 24px !important;
            }
        }
        
        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .header-right {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .student-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 8px;
            }
            
            .calendar-day {
                min-height: 50px;
                font-size: 12px;
            }
            
            .day-number {
                font-size: 14px;
            }
            
            .header-right {
                flex-direction: column;
                gap: 8px;
            }
            
            .control-button {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>ğŸ“‹ ì¶œê²° ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <div class="date-nav-container">
                <button class="date-nav-btn" onclick="changeWorkingDate(-1)">â—€</button>
                <div class="date-display" id="workingDate"></div>
                <button class="date-nav-btn" onclick="changeWorkingDate(1)">â–¶</button>
                <button class="date-nav-btn today-btn" onclick="goToWorkingToday()">ì˜¤ëŠ˜ë¡œ</button>
            </div>
        </div>
        <div class="header-right">
            <button class="control-button history-btn" onclick="showHistory()">ğŸ“š ëˆ„ì  ê¸°ë¡</button>
            <button class="control-button export-btn" onclick="exportTodayToCSV()">ğŸ“„ ì˜¤ëŠ˜ ê¸°ë¡</button>
            <button class="control-button export-btn" onclick="exportAllToCSV()">ğŸ“Š ì „ì²´ ë‚´ë³´ë‚´ê¸°</button>
            <button class="control-button reset-btn" onclick="resetToday()">ğŸ”„ ì˜¤ëŠ˜ ì´ˆê¸°í™”</button>
            <button class="control-button clear-all-btn" onclick="resetAllData()">ğŸ—‘ï¸ ëª¨ë‘ ì´ˆê¸°í™”</button>
        </div>
    </div>
    
    <div class="main-container">
        <div class="left-panel">
            <div class="student-grid" id="studentGrid">
                <!-- í•™ìƒ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
        
        <div class="right-panel">
            <div class="calendar-section">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="changeMonth(-1)">â—€ ì´ì „</button>
                        <h2 class="calendar-title" id="calendarTitle"></h2>
                        <button class="nav-btn" onclick="changeMonth(1)">ë‹¤ìŒ â–¶</button>
                    </div>
                    <button class="nav-btn" onclick="goToToday()">ì˜¤ëŠ˜</button>
                </div>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ëˆ„ì  ê¸°ë¡ ëª¨ë‹¬ -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeHistory()">&times;</span>
            <div class="modal-header">
                <h2>ğŸ“š ëˆ„ì  ì¶œê²° ê¸°ë¡</h2>
                <button class="control-button export-btn" onclick="printHistory()">ğŸ“„ í”„ë¦°íŠ¸</button>
            </div>
            <div id="historyContent">
                <!-- ëˆ„ì  ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- êµì‹œ ì„ íƒ ëª¨ë‹¬ -->
    <div id="periodModal" class="modal">
        <div class="modal-content period-modal">
            <h3 id="periodModalTitle">ëª‡ êµì‹œì¸ê°€ìš”?</h3>
            <div class="period-grid">
                <button class="period-btn" onclick="selectPeriod('ì¡°ë¡€')">ì¡°ë¡€</button>
                <button class="period-btn" onclick="selectPeriod(1)">1êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(2)">2êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(3)">3êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(4)">4êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(5)">5êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(6)">6êµì‹œ</button>
                <button class="period-btn" onclick="selectPeriod(7)">7êµì‹œ</button>
                <button class="period-btn cancel-btn" onclick="closePeriodModal()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        let todayAttendance = {};
        let allRecords = {}; // ë‚ ì§œë³„ ëˆ„ì  ê¸°ë¡
        let currentDate = new Date();
        let selectedDate = new Date();
        let workingDate = new Date(); // í˜„ì¬ ì‘ì—… ì¤‘ì¸ ë‚ ì§œ
        let pendingStudent = null; // êµì‹œ ì„ íƒ ëŒ€ê¸° ì¤‘ì¸ í•™ìƒ
        let pendingStatus = null; // êµì‹œ ì„ íƒ ëŒ€ê¸° ì¤‘ì¸ ìƒíƒœ
        
        // ì‘ì—… ë‚ ì§œ í‘œì‹œ
        function displayWorkingDate() {
            const dateString = workingDate.toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            document.getElementById('workingDate').textContent = dateString;
        }
        
        // ë‹¬ë ¥ ìƒì„±
        function createCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarTitle = document.getElementById('calendarTitle');
            
            // ì›”/ë…„ ì œëª© ì„¤ì •
            const monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', 
                               '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            calendarTitle.textContent = `${currentDate.getFullYear()}ë…„ ${monthNames[currentDate.getMonth()]}`;
            
            // ë‹¬ë ¥ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
            calendarGrid.innerHTML = '';
            
            // ìš”ì¼ í—¤ë” ì¶”ê°€ (í‰ì¼ë§Œ)
            const dayHeaders = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                calendarGrid.appendChild(header);
            });
            
            // ë‹¬ì˜ ì²«ì§¸ ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚  ê³„ì‚°
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            // í•´ë‹¹ ì›”ì˜ ëª¨ë“  ë‚ ì§œë¥¼ ìˆ˜ì§‘í•˜ê³  í‰ì¼ë§Œ í•„í„°ë§
            const weekdays = [];
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                const dayOfWeek = date.getDay(); // 0: ì¼ìš”ì¼, 1: ì›”ìš”ì¼, ..., 6: í† ìš”ì¼
                
                // í‰ì¼ë§Œ í¬í•¨ (ì›”~ê¸ˆ: 1~5)
                if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                    weekdays.push(date);
                }
            }
            
            // ì´ì „ ë‹¬ì˜ í‰ì¼ë“¤ë„ í•„ìš”í•˜ë©´ ì¶”ê°€ (ì²« ì£¼ê°€ ë¹„ì–´ìˆì„ ê²½ìš°)
            const firstWeekday = firstDay.getDay();
            if (firstWeekday > 1) { // ì›”ìš”ì¼(1)ì´ ì•„ë‹Œ ê²½ìš°
                const prevMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
                for (let i = firstWeekday - 1; i >= 1; i--) {
                    const date = new Date(prevMonth.getFullYear(), prevMonth.getMonth(), prevMonth.getDate() - (firstWeekday - 1 - i));
                    if (date.getDay() >= 1 && date.getDay() <= 5) {
                        weekdays.unshift(date);
                    }
                }
            }
            
            // ë‹¤ìŒ ë‹¬ì˜ í‰ì¼ë“¤ë„ í•„ìš”í•˜ë©´ ì¶”ê°€ (ë§ˆì§€ë§‰ ì£¼ê°€ ë¹„ì–´ìˆì„ ê²½ìš°)
            const totalDays = weekdays.length;
            const weeksNeeded = Math.ceil(totalDays / 5);
            const totalCells = weeksNeeded * 5;
            
            if (totalDays < totalCells) {
                const nextMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
                let day = 1;
                while (weekdays.length < totalCells) {
                    const date = new Date(nextMonth.getFullYear(), nextMonth.getMonth(), day);
                    if (date.getDay() >= 1 && date.getDay() <= 5) {
                        weekdays.push(date);
                    }
                    day++;
                }
            }
            
            // í‰ì¼ë“¤ë§Œ ë‹¬ë ¥ì— í‘œì‹œ
            weekdays.forEach(date => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // ë‹¤ë¥¸ ë‹¬ì¸ì§€ í™•ì¸
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                // ì˜¤ëŠ˜ì¸ì§€ í™•ì¸
                const today = new Date();
                if (date.toDateString() === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // ì„ íƒëœ ë‚ ì§œì¸ì§€ í™•ì¸
                if (date.toDateString() === selectedDate.toDateString()) {
                    dayElement.classList.add('selected');
                }
                
                // ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸
                dayElement.onclick = () => selectDate(date);
                
                // ë‚ ì§œ ë²ˆí˜¸
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = date.getDate();
                dayElement.appendChild(dayNumber);
                
                // í•´ë‹¹ ë‚ ì§œì˜ ì¶œê²° í•™ìƒ ë²ˆí˜¸ í‘œì‹œ
                const dateKey = date.toLocaleDateString('ko-KR');
                if (allRecords[dateKey]) {
                    const dayStats = document.createElement('div');
                    dayStats.className = 'day-stats';
                    
                    const studentsByStatus = getStudentsByStatus(allRecords[dateKey]);
                    
                    // ê²°ì„ í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus.absent.length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge absent';
                        const sortedNumbers = studentsByStatus.absent.sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ê²°ì„: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    // ì§€ê° í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus.late.length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge late';
                        const sortedNumbers = studentsByStatus.late.sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ì§€ê°: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    // ì¡°í‡´ í•™ìƒ ë²ˆí˜¸ë“¤
                    if (studentsByStatus['early-leave'].length > 0) {
                        const badge = document.createElement('span');
                        badge.className = 'stat-badge early';
                        const sortedNumbers = studentsByStatus['early-leave'].sort((a, b) => a - b);
                        const displayText = getDisplayText(sortedNumbers);
                        badge.textContent = displayText;
                        badge.title = `ì¡°í‡´: ${sortedNumbers.join(', ')}ë²ˆ`;
                        dayStats.appendChild(badge);
                    }
                    
                    dayElement.appendChild(dayStats);
                }
                
                calendarGrid.appendChild(dayElement);
            });
        }
        
        // ë‚ ì§œë³„ í†µê³„ ê³„ì‚°
        function getDateStats(dayRecords) {
            const stats = { absent: 0, late: 0, 'early-leave': 0 };
            
            Object.values(dayRecords).forEach(record => {
                if (stats.hasOwnProperty(record.status)) {
                    stats[record.status]++;
                }
            });
            
            return stats;
        }
        
        // ë‚ ì§œë³„ í•™ìƒ ë²ˆí˜¸ ë¶„ë¥˜
        function getStudentsByStatus(dayRecords) {
            const studentsByStatus = { 
                absent: [], 
                late: [], 
                'early-leave': [] 
            };
            
            Object.keys(dayRecords).forEach(studentNumber => {
                const record = dayRecords[studentNumber];
                if (studentsByStatus.hasOwnProperty(record.status)) {
                    studentsByStatus[record.status].push(parseInt(studentNumber));
                }
            });
            
            return studentsByStatus;
        }
        
        // í•™ìƒ ë²ˆí˜¸ í‘œì‹œ í…ìŠ¤íŠ¸ ìƒì„± (ë„ˆë¬´ ê¸¸ë©´ ì¤„ì„)
        function getDisplayText(numbers) {
            const text = numbers.join(',');
            
            // 12ê¸€ì ì´í•˜ë©´ ê·¸ëŒ€ë¡œ í‘œì‹œ
            if (text.length <= 12) {
                return text;
            }
            
            // ë„ˆë¬´ ê¸¸ë©´ ì•ì˜ ëª‡ ê°œë§Œ í‘œì‹œí•˜ê³  +ê°œìˆ˜ ì¶”ê°€
            let displayText = '';
            let charCount = 0;
            let displayCount = 0;
            
            for (let i = 0; i < numbers.length; i++) {
                const numberText = numbers[i].toString();
                const separator = i > 0 ? ',' : '';
                
                if (charCount + separator.length + numberText.length <= 8) {
                    displayText += separator + numberText;
                    charCount += separator.length + numberText.length;
                    displayCount++;
                } else {
                    break;
                }
            }
            
            const remaining = numbers.length - displayCount;
            if (remaining > 0) {
                displayText += `+${remaining}`;
            }
            
            return displayText;
        }
        
        // ë‹¬ ë³€ê²½
        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œ ë³€ê²½ (í‰ì¼ë§Œ)
        function changeWorkingDate(direction) {
            let newDate = new Date(workingDate);
            
            do {
                newDate.setDate(newDate.getDate() + direction);
            } while (newDate.getDay() === 0 || newDate.getDay() === 6); // ì£¼ë§ ê±´ë„ˆë›°ê¸°
            
            workingDate = newDate;
            selectedDate = new Date(workingDate); // ì„ íƒëœ ë‚ ì§œë„ í•¨ê»˜ ë³€ê²½
            
            // ì‘ì—… ë‚ ì§œê°€ í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ë‹¬ê³¼ ë‹¤ë¥´ë©´ ë‹¬ë ¥ ì›” ë³€ê²½
            if (workingDate.getMonth() !== currentDate.getMonth() || 
                workingDate.getFullYear() !== currentDate.getFullYear()) {
                currentDate = new Date(workingDate);
            }
            
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œë¥¼ ì˜¤ëŠ˜ë¡œ ë³€ê²½
        function goToWorkingToday() {
            const today = new Date();
            // ì˜¤ëŠ˜ì´ ì£¼ë§ì´ë©´ ê°€ì¥ ê°€ê¹Œìš´ í‰ì¼ë¡œ
            if (today.getDay() === 0) { // ì¼ìš”ì¼
                today.setDate(today.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (today.getDay() === 6) { // í† ìš”ì¼
                today.setDate(today.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            workingDate = today;
            selectedDate = new Date(workingDate);
            currentDate = new Date(workingDate);
            
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì˜¤ëŠ˜ë¡œ ì´ë™
        function goToToday() {
            currentDate = new Date();
            selectedDate = new Date();
            createCalendar();
        }
        
        // ë‚ ì§œ ì„ íƒ
        function selectDate(date) {
            selectedDate = new Date(date);
            
            // ì‘ì—… ë‚ ì§œë„ í•¨ê»˜ ë³€ê²½ (í‰ì¼ë§Œ)
            if (date.getDay() >= 1 && date.getDay() <= 5) { // í‰ì¼ì¸ ê²½ìš°ë§Œ
                workingDate = new Date(date);
                
                // í™”ë©´ ì—…ë°ì´íŠ¸
                displayWorkingDate();
                loadWorkingDateData();
            }
            
            createCalendar();
        }
        
        // í•™ìƒ ì¹´ë“œë“¤ ìƒì„±
        function createStudentCards() {
            const studentGrid = document.getElementById('studentGrid');
            
            for (let i = 1; i <= 35; i++) {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.id = `student-${i}`;
                
                card.innerHTML = `
                    <div class="student-header">
                        <div class="student-status" id="status-${i}"></div>
                        <div class="student-number">${i}ë²ˆ</div>
                    </div>
                    <div class="button-group">
                        <button class="status-btn btn-absent" onclick="setAttendance(${i}, 'absent')">ê²°ì„</button>
                        <button class="status-btn btn-late" onclick="showPeriodModal(${i}, 'late')">ì§€ê°</button>
                        <button class="status-btn btn-early" onclick="showPeriodModal(${i}, 'early-leave')">ì¡°í‡´</button>
                        <button class="status-btn btn-clear" onclick="clearAttendance(${i})">ì·¨ì†Œ</button>
                    </div>
                `;
                
                studentGrid.appendChild(card);
            }
        }
        
        // ì‘ì—… ë‚ ì§œ ë°ì´í„° ë¡œë“œ
        function loadWorkingDateData() {
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í•´ë‹¹ ë‚ ì§œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            const savedData = localStorage.getItem(`attendance_${workingDateKey}`);
            let workingData = {};
            
            if (savedData) {
                workingData = JSON.parse(savedData);
                // allRecordsì—ë„ ë™ê¸°í™”
                allRecords[workingDateKey] = { ...workingData };
            } else {
                // allRecordsì—ì„œ ì°¾ê¸°
                workingData = allRecords[workingDateKey] || {};
            }
            
            // ëª¨ë“  í•™ìƒì„ ì •ìƒ ìƒíƒœë¡œ ì´ˆê¸°í™”
            for (let i = 1; i <= 35; i++) {
                const card = document.getElementById(`student-${i}`);
                const statusDiv = document.getElementById(`status-${i}`);
                
                if (card && statusDiv) {
                    card.classList.remove('absent', 'late', 'early-leave');
                    statusDiv.textContent = '';
                }
            }
            
            // í•´ë‹¹ ë‚ ì§œì˜ ì¶œê²° ë°ì´í„° ë³µì›
            todayAttendance = { ...workingData };
            
            Object.keys(workingData).forEach(studentNumber => {
                const record = workingData[studentNumber];
                const card = document.getElementById(`student-${studentNumber}`);
                const statusDiv = document.getElementById(`status-${studentNumber}`);
                
                if (card && statusDiv) {
                    card.classList.add(record.status);
                    let displayText = getStatusKorean(record.status);
                    if (record.period && (record.status === 'late' || record.status === 'early-leave')) {
                        displayText += ` (${record.period}êµì‹œ)`;
                    }
                    statusDiv.textContent = displayText;
                }
            });
            
            updateTodayStats();
        }
        
        // êµì‹œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        function showPeriodModal(studentNumber, status) {
            pendingStudent = studentNumber;
            pendingStatus = status;
            
            const modal = document.getElementById('periodModal');
            const title = document.getElementById('periodModalTitle');
            
            const statusText = status === 'late' ? 'ì§€ê°' : 'ì¡°í‡´';
            title.textContent = `${studentNumber}ë²ˆ í•™ìƒ ${statusText} - ëª‡ êµì‹œì¸ê°€ìš”?`;
            
            modal.style.display = 'block';
        }
        
        // êµì‹œ ì„ íƒ
        function selectPeriod(period) {
            if (pendingStudent && pendingStatus) {
                setAttendanceWithPeriod(pendingStudent, pendingStatus, period);
                closePeriodModal();
            }
        }
        
        // êµì‹œ ëª¨ë‹¬ ë‹«ê¸°
        function closePeriodModal() {
            document.getElementById('periodModal').style.display = 'none';
            pendingStudent = null;
            pendingStatus = null;
        }
        
        // êµì‹œ ì •ë³´ê°€ í¬í•¨ëœ ì¶œê²° ìƒíƒœ ì„¤ì •
        function setAttendanceWithPeriod(studentNumber, status, period = null) {
            const card = document.getElementById(`student-${studentNumber}`);
            const statusDiv = document.getElementById(`status-${studentNumber}`);
            const currentTime = new Date();
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ì´ì „ ìƒíƒœ ì œê±°
            card.classList.remove('absent', 'late', 'early-leave');
            
            // ìƒˆ ìƒíƒœ ì„¤ì •
            card.classList.add(status);
            
            const statusText = {
                'absent': 'ê²°ì„',
                'late': 'ì§€ê°',
                'early-leave': 'ì¡°í‡´'
            };
            
            const timeString = currentTime.toLocaleTimeString('ko-KR', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // êµì‹œ ì •ë³´ í¬í•¨ëœ í…ìŠ¤íŠ¸ ìƒì„±
            let displayText = statusText[status];
            if (period && (status === 'late' || status === 'early-leave')) {
                displayText += ` (${period}êµì‹œ)`;
            }
            
            statusDiv.textContent = displayText;
            
            // ì‘ì—… ë‚ ì§œ ì¶œê²° ê¸°ë¡ì— ì¶”ê°€
            if (!todayAttendance[studentNumber] || todayAttendance[studentNumber].status !== status || todayAttendance[studentNumber].period !== period) {
                todayAttendance[studentNumber] = {
                    status: status,
                    time: timeString,
                    timestamp: currentTime.toISOString(),
                    date: workingDateKey,
                    period: period // êµì‹œ ì •ë³´ ì¶”ê°€
                };
            }
            
            // ë¨¼ì € allRecords ì—…ë°ì´íŠ¸
            allRecords[workingDateKey] = { ...todayAttendance };
            
            updateTodayStats();
            saveWorkingDateData();
            
            
            // ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨ (ì‘ì—… ë‚ ì§œì— ë°°ì§€ í‘œì‹œ) - ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ í™•ì‹¤í•œ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                createCalendar();
            }, 10);
            
            const periodText = period ? ` (${period}êµì‹œ)` : '';
            showMessage(`${studentNumber}ë²ˆ í•™ìƒì´ ${statusText[status]}${periodText}ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì¶œê²° ìƒíƒœ ì„¤ì • (ê²°ì„ìš© - êµì‹œ ì—†ìŒ)
        function setAttendance(studentNumber, status) {
            // ê²°ì„ì€ êµì‹œ ì •ë³´ ì—†ì´ ë°”ë¡œ ì²˜ë¦¬
            setAttendanceWithPeriod(studentNumber, status, null);
        }
        
        // ì¶œê²° ìƒíƒœ ì·¨ì†Œ
        function clearAttendance(studentNumber) {
            const card = document.getElementById(`student-${studentNumber}`);
            const statusDiv = document.getElementById(`status-${studentNumber}`);
            
            // ìƒíƒœ ì œê±°
            card.classList.remove('absent', 'late', 'early-leave');
            statusDiv.textContent = '';
            
            // ê¸°ë¡ì—ì„œ ì œê±°
            delete todayAttendance[studentNumber];
            
            // ë¨¼ì € allRecords ì—…ë°ì´íŠ¸
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            allRecords[workingDateKey] = { ...todayAttendance };
            
            updateTodayStats();
            saveWorkingDateData();
            
            
            // ë‹¬ë ¥ ìƒˆë¡œê³ ì¹¨ - ì•½ê°„ì˜ ì§€ì—°ìœ¼ë¡œ í™•ì‹¤í•œ ì—…ë°ì´íŠ¸
            setTimeout(() => {
                createCalendar();
            }, 10);
            
            showMessage(`${studentNumber}ë²ˆ í•™ìƒì˜ ì¶œê²°ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }
        
        // ì˜¤ëŠ˜ í†µê³„ ì—…ë°ì´íŠ¸ (í†µê³„ ì„¹ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ë¹ˆ í•¨ìˆ˜)
        function updateTodayStats() {
            // í†µê³„ í‘œì‹œ ì„¹ì…˜ì´ ì œê±°ë˜ì—ˆìœ¼ë¯€ë¡œ ì‹¤ì œ ë™ì‘ì€ í•˜ì§€ ì•ŠìŒ
            // í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë¥˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ë¹ˆ í•¨ìˆ˜ë¡œ ìœ ì§€
        }
        
        
        
        // ìƒíƒœ í•œê¸€ ë³€í™˜
        function getStatusKorean(status) {
            const statusMap = {
                'absent': 'ê²°ì„',
                'late': 'ì§€ê°',
                'early-leave': 'ì¡°í‡´'
            };
            return statusMap[status] || status;
        }
        
        
        // ë©”ì‹œì§€ í‘œì‹œ (ê°„ë‹¨í•œ ì½˜ì†” ë¡œê·¸)
        function showMessage(message) {
            console.log(message);
        }
        
        // ì˜¤ëŠ˜ ì´ˆê¸°í™”
        function resetToday() {
            if (confirm('ì˜¤ëŠ˜ì˜ ì¶œê²°ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todayAttendance = {};
                
                // ëª¨ë“  í•™ìƒì„ ì¶œì„ìœ¼ë¡œ ì´ˆê¸°í™”
                for (let i = 1; i <= 35; i++) {
                    const card = document.getElementById(`student-${i}`);
                    const statusDiv = document.getElementById(`status-${i}`);
                    
                    card.classList.remove('absent', 'late', 'early-leave');
                    card.classList.add('present');
                    statusDiv.textContent = 'ì¶œì„';
                }
                
                updateTodayStats();
                saveToLocalStorage();
                
                showMessage('ì˜¤ëŠ˜ ì¶œê²°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì˜¤ëŠ˜ ê¸°ë¡ CSV ë‚´ë³´ë‚´ê¸°
        function exportTodayToCSV() {
            const records = Object.keys(todayAttendance).map(studentNumber => {
                const record = todayAttendance[studentNumber];
                return `${record.date},${studentNumber},${getStatusKorean(record.status)},${record.time}`;
            });
            
            if (records.length === 0) {
                alert('ë‚´ë³´ë‚¼ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const workingDateString = workingDate.toLocaleDateString('ko-KR', {
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            if (confirm(`${workingDateString}ì˜ ì¶œê²° ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${records.length}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                const today = new Date().toLocaleDateString('ko-KR');
                const csvContent = 'data:text/csv;charset=utf-8,' 
                    + 'ë‚ ì§œ,í•™ìƒë²ˆí˜¸,ìƒíƒœ,ì‹œê°„\n'
                    + records.join('\n');
                
                downloadCSV(csvContent, `ì¶œê²°ê¸°ë¡_${today}.csv`);
            }
        }
        
        // ì „ì²´ ê¸°ë¡ CSV ë‚´ë³´ë‚´ê¸°
        function exportAllToCSV() {
            let allCsvRecords = [];
            
            Object.keys(allRecords).forEach(date => {
                Object.keys(allRecords[date]).forEach(studentNumber => {
                    const record = allRecords[date][studentNumber];
                    allCsvRecords.push(`${date},${studentNumber},${getStatusKorean(record.status)},${record.time}`);
                });
            });
            
            if (allCsvRecords.length === 0) {
                alert('ë‚´ë³´ë‚¼ ëˆ„ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const totalDays = Object.keys(allRecords).length;
            
            if (confirm(`ì „ì²´ ì¶œê²° ê¸°ë¡ì„ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${totalDays}ì¼ê°„ ${allCsvRecords.length}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                const csvContent = 'data:text/csv;charset=utf-8,' 
                    + 'ë‚ ì§œ,í•™ìƒë²ˆí˜¸,ìƒíƒœ,ì‹œê°„\n'
                    + allCsvRecords.join('\n');
                
                const today = new Date().toLocaleDateString('ko-KR');
                downloadCSV(csvContent, `ì „ì²´ì¶œê²°ê¸°ë¡_${today}.csv`);
            }
        }
        
        // CSV ë‹¤ìš´ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        function downloadCSV(csvContent, filename) {
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement('a');
            link.setAttribute('href', encodedUri);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ëˆ„ì  ê¸°ë¡ ë³´ê¸°
        function showHistory() {
            const modal = document.getElementById('historyModal');
            const content = document.getElementById('historyContent');
            
            if (Object.keys(allRecords).length === 0) {
                content.innerHTML = '<p style="text-align: center; color: #666;">ì•„ì§ ëˆ„ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                let historyHTML = '';
                
                Object.keys(allRecords).sort().reverse().forEach(date => {
                    const dayRecords = allRecords[date];
                    const recordCount = Object.keys(dayRecords).length;
                    
                    historyHTML += `
                        <div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                            <h4 style="cursor: pointer; color: #007bff; text-decoration: underline;" onclick="goToDate('${date}')" title="í´ë¦­í•˜ì—¬ ${date}ë¡œ ì´ë™">${date} (${recordCount}ê±´)</h4>
                            <div style="display: grid; gap: 8px;">
                    `;
                    
                    Object.keys(dayRecords).forEach(studentNumber => {
                        const record = dayRecords[studentNumber];
                        let statusText = getStatusKorean(record.status);
                        if (record.period && (record.status === 'late' || record.status === 'early-leave')) {
                            statusText += ` (${record.period}êµì‹œ)`;
                        }
                        historyHTML += `
                            <div style="display: flex; justify-content: space-between; padding: 8px; background-color: white; border-radius: 4px;">
                                <span><strong>${studentNumber}ë²ˆ</strong> - ${statusText}</span>
                                <span>${record.time}</span>
                            </div>
                        `;
                    });
                    
                    historyHTML += '</div></div>';
                });
                
                content.innerHTML = historyHTML;
            }
            
            modal.style.display = 'block';
        }
        
        // ëˆ„ì  ê¸°ë¡ ëª¨ë‹¬ ë‹«ê¸°
        function closeHistory() {
            document.getElementById('historyModal').style.display = 'none';
        }
        
        // ëˆ„ì  ê¸°ë¡ í”„ë¦°íŠ¸
        function printHistory() {
            if (Object.keys(allRecords).length === 0) {
                alert('í”„ë¦°íŠ¸í•  ëˆ„ì  ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            const totalRecords = Object.keys(allRecords).reduce((total, date) => {
                return total + Object.keys(allRecords[date]).length;
            }, 0);
            
            if (confirm(`ëˆ„ì  ì¶œê²° ê¸°ë¡ì„ í”„ë¦°íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ${Object.keys(allRecords).length}ì¼ê°„ ${totalRecords}ê±´ì˜ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.`)) {
                window.print();
            }
        }
        
        // íŠ¹ì • ë‚ ì§œë¡œ ì´ë™ (ëˆ„ì  ê¸°ë¡ì—ì„œ í˜¸ì¶œ)
        function goToDate(dateString) {
            // í•œêµ­ ë‚ ì§œ ë¬¸ìì—´ì„ Date ê°ì²´ë¡œ ë³€í™˜
            const dateParts = dateString.split('.');
            const year = parseInt(dateParts[0]);
            const month = parseInt(dateParts[1]) - 1; // JavaScript ì›”ì€ 0ë¶€í„° ì‹œì‘
            const day = parseInt(dateParts[2]);
            
            const targetDate = new Date(year, month, day);
            
            // ì£¼ë§ì¸ì§€ í™•ì¸í•˜ê³  í‰ì¼ë¡œ ì¡°ì •
            if (targetDate.getDay() === 0) { // ì¼ìš”ì¼
                targetDate.setDate(targetDate.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (targetDate.getDay() === 6) { // í† ìš”ì¼
                targetDate.setDate(targetDate.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            // ì‘ì—… ë‚ ì§œì™€ ì„ íƒëœ ë‚ ì§œ ë³€ê²½
            workingDate = new Date(targetDate);
            selectedDate = new Date(targetDate);
            currentDate = new Date(targetDate);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeHistory();
            
            // í™”ë©´ ì—…ë°ì´íŠ¸
            displayWorkingDate();
            loadWorkingDateData();
            createCalendar();
        }
        
        // ì‘ì—… ë‚ ì§œ ë°ì´í„° ì €ì¥
        function saveWorkingDateData() {
            const workingDateKey = workingDate.toLocaleDateString('ko-KR');
            
            // ì‘ì—… ë‚ ì§œ ê¸°ë¡ ì €ì¥
            localStorage.setItem(`attendance_${workingDateKey}`, JSON.stringify(todayAttendance));
            
            // ëˆ„ì  ê¸°ë¡ì— ì¶”ê°€
            allRecords[workingDateKey] = { ...todayAttendance };
            localStorage.setItem('attendance_all', JSON.stringify(allRecords));
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (í•˜ìœ„ í˜¸í™˜ìš©)
        function saveToLocalStorage() {
            saveWorkingDateData();
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadFromLocalStorage() {
            // ëˆ„ì  ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
            const allData = localStorage.getItem('attendance_all');
            if (allData) {
                allRecords = JSON.parse(allData);
            }
        }
        
        // ì‘ì—… ë‚ ì§œ ì´ˆê¸°í™”
        function resetToday() {
            const workingDateString = workingDate.toLocaleDateString('ko-KR', {
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            
            if (confirm(`${workingDateString}ì˜ ì¶œê²°ì„ ëª¨ë‘ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                todayAttendance = {};
                
                // ëª¨ë“  í•™ìƒì„ ì •ìƒìœ¼ë¡œ ì´ˆê¸°í™”
                for (let i = 1; i <= 35; i++) {
                    const card = document.getElementById(`student-${i}`);
                    const statusDiv = document.getElementById(`status-${i}`);
                    
                    card.classList.remove('absent', 'late', 'early-leave');
                    statusDiv.textContent = '';
                }
                
                updateTodayStats();
                saveWorkingDateData();
                
                // ë‹¬ë ¥ì´ ì‘ì—… ë‚ ì§œë¥¼ ë³´ì—¬ì£¼ê³  ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
                if (selectedDate.toDateString() === workingDate.toDateString()) {
                    updateSelectedDateRecords();
                }
                
                createCalendar();
                showMessage('ì¶œê²°ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
        function resetAllData() {
            if (confirm('âš ï¸ ê²½ê³ : ëª¨ë“  ë‚ ì§œì˜ ì¶œê²° ê¸°ë¡ì´ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤.\n\nì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                if (confirm('í•œë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤. ì •ë§ë¡œ ëª¨ë“  ì¶œê²° ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                    todayAttendance = {};
                    allRecords = {};
                    
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ëª¨ë“  ì¶œê²° ë°ì´í„° ì‚­ì œ
                    const keys = Object.keys(localStorage);
                    keys.forEach(key => {
                        if (key.startsWith('attendance_')) {
                            localStorage.removeItem(key);
                        }
                    });
                    
                    // í˜„ì¬ í™”ë©´ ì´ˆê¸°í™”
                    for (let i = 1; i <= 35; i++) {
                        const card = document.getElementById(`student-${i}`);
                        const statusDiv = document.getElementById(`status-${i}`);
                        
                        card.classList.remove('absent', 'late', 'early-leave');
                        statusDiv.textContent = '';
                    }
                    
                    updateTodayStats();
                    createCalendar();
                    
                    alert('âœ… ëª¨ë“  ì¶œê²° ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì˜¤ëŠ˜ ë°ì´í„° ë³µì›
        function restoreTodayData() {
            const today = new Date().toLocaleDateString('ko-KR');
            const todayData = localStorage.getItem(`attendance_${today}`);
            
            if (todayData) {
                todayAttendance = JSON.parse(todayData);
                
                // í™”ë©´ì— ë°˜ì˜
                Object.keys(todayAttendance).forEach(studentNumber => {
                    const record = todayAttendance[studentNumber];
                    const card = document.getElementById(`student-${studentNumber}`);
                    const statusDiv = document.getElementById(`status-${studentNumber}`);
                    
                    if (card && statusDiv) {
                        card.classList.remove('absent', 'late', 'early-leave');
                        card.classList.add(record.status);
                        statusDiv.textContent = `${getStatusKorean(record.status)} (${record.time})`;
                    }
                });
                
                updateTodayStats();
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            // ì‘ì—… ë‚ ì§œ ì´ˆê¸°í™” (ì˜¤ëŠ˜ì´ ì£¼ë§ì´ë©´ í‰ì¼ë¡œ ì¡°ì •)
            const today = new Date();
            if (today.getDay() === 0) { // ì¼ìš”ì¼
                workingDate.setDate(today.getDate() + 1); // ì›”ìš”ì¼ë¡œ
            } else if (today.getDay() === 6) { // í† ìš”ì¼
                workingDate.setDate(today.getDate() + 2); // ì›”ìš”ì¼ë¡œ
            }
            
            // ëª¨ë“  ë‚ ì§œ ë³€ìˆ˜ë¥¼ ë™ê¸°í™”
            currentDate = new Date(workingDate);
            selectedDate = new Date(workingDate);
            
            displayWorkingDate();
            createStudentCards();
            loadFromLocalStorage();
            loadWorkingDateData();
            createCalendar();
        };
        
        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const historyModal = document.getElementById('historyModal');
            const periodModal = document.getElementById('periodModal');
            
            if (event.target === historyModal) {
                historyModal.style.display = 'none';
            }
            
            if (event.target === periodModal) {
                closePeriodModal();
            }
        };
    </script>
</body>
</html>
